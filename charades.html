<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Charades Timer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      color-scheme: dark;
      --bg: #1e1e1e;
      --card: #2a2a2a;
      --text: #f5f5f5;
      --subtle: #cccccc;
      --primary: #4f8cff;
      --secondary: #444;
      --danger: #ff4f4f;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      height: 100dvh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
    }

    main {
      flex: 1;
      max-width: 600px;
      max-height: 100dvh;
      margin: 0 auto;
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .screen {
      display: none;
      flex: 1;
      flex-direction: column;
      justify-content: center;
      gap: 1rem;
    }

    .screen.active { display: flex; }

    h1, h2, h3, p {
      color: var(--text);
      text-align: center;
      margin: 0.5rem 0;
    }

    .timer {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      margin-top: 0.5rem;
      color: #ffffff;
    }

    .word-box {
      margin: 1.5rem 0;
      padding: 1.5rem 1.25rem;
      border-radius: 1rem;
      background: var(--card);
      text-align: center;
      font-size: 2rem;
      font-weight: 600;
      color: var(--text);
      box-shadow: 0 4px 12px rgba(0,0,0,0.35);
      word-wrap: break-word;
    }

    .buttons {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: auto;
    }

    button {
      padding: 1rem;
      font-size: 1.1rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      touch-action: manipulation;
      color: #fff;
    }

    button:active { transform: scale(0.97); }

    .btn-primary { background: var(--primary); }
    .btn-secondary { background: var(--secondary); }
    .btn-danger { background: var(--danger); }

    .summary-section {
      background: var(--card);
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      max-height: 40vh;
      overflow-y: auto;
    }

    ul {
      padding-left: 1.25rem;
      margin: 0.25rem 0 0.75rem;
      color: var(--subtle);
    }

    .score {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 2.5rem;
      height: 2.5rem;
      padding: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      color: var(--subtle);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      line-height: 1;
    }

    .close-btn:active {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(0.95);
    }

    .word-set-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-width: 400px;
      margin: 0 auto;
      width: 100%;
    }

    .word-set-btn {
      padding: 1.25rem;
      font-size: 1.2rem;
      border-radius: 1rem;
      background: var(--card);
      color: var(--text);
      border: 2px solid transparent;
      cursor: pointer;
      font-weight: 600;
      text-align: center;
      transition: all 0.2s;
    }

    .word-set-btn:hover {
      border-color: var(--primary);
    }

    .word-set-btn:active {
      transform: scale(0.98);
      background: var(--primary);
    }

    @media (min-width: 600px) {
      .buttons { flex-direction: row; }
      .buttons button { width: 50%; }
    }
  </style>
</head>
<body>
  <main>
    <!-- Word Set Selection Screen -->
    <section id="screen-select" class="screen active">
      <h1>Charades</h1>
      <p>Choose a word set</p>
      <div class="word-set-list" id="word-set-list"></div>
      <div class="buttons">
        <button class="btn-secondary" onclick="goHome()">Back</button>
      </div>
    </section>

    <!-- Start Screen -->
    <section id="screen-start" class="screen">
      <h1>Charades</h1>
      <p>60 seconds to guess as many words as you can.</p>
      <p>Tap <strong>Correct</strong> when your team guesses it, or <strong>Skip</strong> to move on.</p>
      <div class="buttons">
        <button class="btn-secondary" id="start-back-btn" onclick="goToSelect()">Back</button>
        <button class="btn-primary" onclick="startGame()">Start Game</button>
      </div>
    </section>

    <!-- Game Screen -->
    <section id="screen-game" class="screen">
      <button class="close-btn" onclick="confirmEndGame()">Ã—</button>
      <h2>Go!</h2>
      <div class="timer" id="timer">60</div>
      <div class="word-box" id="current-word">Word will appear here</div>
      <div class="buttons">
        <button class="btn-secondary" onclick="skipWord()">Skip</button>
        <button class="btn-primary" onclick="correctWord()">Correct</button>
      </div>
    </section>

    <!-- Summary Screen -->
    <section id="screen-summary" class="screen">
      <h2>Time's up!</h2>
      <p class="score">Score: <span id="summary-score">0</span></p>

      <div class="summary-section">
        <h3>Correct guesses</h3>
        <ul id="correct-list"></ul>

        <h3>Skipped</h3>
        <ul id="skipped-list"></ul>
      </div>

      <div class="buttons">
        <button class="btn-primary" onclick="startGame()">Play Again</button>
        <button class="btn-secondary" id="summary-back-btn" onclick="goToSelect()">Change Word Set</button>
      </div>
    </section>
  </main>

  <script>
    let wordSets = [];
    let selectedWordSet = null;
    let words = [];
    let timerSeconds = 60;
    let timerId = null;
    let currentIndex = 0;
    let correct = [];
    let skipped = [];
    let hasMultipleSets = false;

    async function discoverWordSets() {
      const sets = [];
      let i = 1;

      while (true) {
        try {
          const response = await fetch(`word-sets/charades-${i}.txt`);
          if (response.ok) {
            const text = await response.text();
            const lines = text.split('\n').map(w => w.trim()).filter(w => w.length > 0);
            const displayName = lines.length > 0 ? lines[0] : `charades-${i}`;
            sets.push({ filename: `charades-${i}`, displayName });
            i++;
          } else {
            break;
          }
        } catch {
          break;
        }
      }

      return sets;
    }

    async function initWordSetList() {
      const listEl = document.getElementById('word-set-list');
      listEl.innerHTML = '<p>Loading word sets...</p>';

      wordSets = await discoverWordSets();

      listEl.innerHTML = '';

      if (wordSets.length === 0) {
        listEl.innerHTML = '<p>No word sets found</p>';
        return;
      }

      hasMultipleSets = wordSets.length > 1;

      if (wordSets.length === 1) {
        await selectWordSet(wordSets[0].filename);
        return;
      }

      wordSets.forEach(set => {
        const btn = document.createElement('button');
        btn.className = 'word-set-btn';
        btn.textContent = set.displayName;
        btn.onclick = () => selectWordSet(set.filename);
        listEl.appendChild(btn);
      });
    }

    async function selectWordSet(setName) {
      selectedWordSet = setName;
      await loadWords(setName);
      updateStartScreenBackButton();
      showScreen('screen-start');
    }

    function updateStartScreenBackButton() {
      const startBackBtn = document.getElementById('start-back-btn');
      if (startBackBtn) {
        if (hasMultipleSets) {
          startBackBtn.textContent = 'Back';
          startBackBtn.onclick = goToSelect;
        } else {
          startBackBtn.textContent = 'Back';
          startBackBtn.onclick = goHome;
        }
      }
    }

    async function loadWords(setName) {
      try {
        const response = await fetch(`word-sets/${setName}.txt`);
        const text = await response.text();
        const lines = text.split('\n').map(w => w.trim()).filter(w => w.length > 0);
        words = lines.slice(1);
      } catch (error) {
        console.error('Failed to load words:', error);
        words = ['Error loading words'];
      }
    }

    initWordSetList();

    goToSelect();

    function goHome() {
      window.location.href = 'index.html';
    }

    function showScreen(id) {
      const screens = document.querySelectorAll('.screen');
      screens.forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function updateTimerDisplay() {
      const timerEl = document.getElementById('timer');
      if (timerEl) timerEl.textContent = timerSeconds;
    }

    function showWord() {
      const wordEl = document.getElementById('current-word');
      if (!wordEl || words.length === 0) return;
      wordEl.textContent = words[currentIndex];
    }

    function nextWord() {
      if (words.length === 0) return;

      currentIndex++;
      if (currentIndex >= words.length) {
        // If we reach the end, reshuffle and start from the beginning
        shuffle(words);
        currentIndex = 0;
      }
      showWord();
    }

    function startGame() {
      // Reset state
      correct = [];
      skipped = [];
      timerSeconds = 60;
      currentIndex = 0;
      shuffle(words);
      showWord();
      updateTimerDisplay();

      // Switch screen
      showScreen('screen-game');

      // Clear any previous timer
      if (timerId !== null) {
        clearInterval(timerId);
      }

      // Start timer
      timerId = setInterval(() => {
        timerSeconds--;
        if (timerSeconds < 0) {
          timerSeconds = 0;
        }
        updateTimerDisplay();

        if (timerSeconds <= 0) {
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      if (timerId !== null) {
        clearInterval(timerId);
        timerId = null;
      }
      populateSummary();
      showScreen('screen-summary');
    }

    function correctWord() {
      if (timerSeconds <= 0) return;
      correct.push(words[currentIndex]);
      nextWord();
    }

    function skipWord() {
      if (timerSeconds <= 0) return;
      skipped.push(words[currentIndex]);
      nextWord();
    }

    function populateSummary() {
      const scoreEl = document.getElementById('summary-score');
      const correctListEl = document.getElementById('correct-list');
      const skippedListEl = document.getElementById('skipped-list');
      const summaryBackBtn = document.getElementById('summary-back-btn');

      if (summaryBackBtn) {
        if (hasMultipleSets) {
          summaryBackBtn.textContent = 'Change Word Set';
          summaryBackBtn.onclick = goToSelect;
        } else {
          summaryBackBtn.textContent = 'Back';
          summaryBackBtn.onclick = goHome;
        }
      }

      scoreEl.textContent = correct.length;

      correctListEl.innerHTML = "";
      skippedListEl.innerHTML = "";

      if (correct.length === 0) {
        const li = document.createElement('li');
        li.textContent = "None this round.";
        correctListEl.appendChild(li);
      } else {
        correct.forEach(word => {
          const li = document.createElement('li');
          li.textContent = word;
          correctListEl.appendChild(li);
        });
      }

      if (skipped.length === 0) {
        const li = document.createElement('li');
        li.textContent = "None skipped.";
        skippedListEl.appendChild(li);
      } else {
        skipped.forEach(word => {
          const li = document.createElement('li');
          li.textContent = word;
          skippedListEl.appendChild(li);
        });
      }
    }

    function confirmEndGame() {
      if (confirm('End this round early?')) {
        endGame();
      }
    }

    function goToStart() {
      if (timerId !== null) {
        clearInterval(timerId);
        timerId = null;
      }
      showScreen('screen-start');
    }

    function goToSelect() {
      if (timerId !== null) {
        clearInterval(timerId);
        timerId = null;
      }
      showScreen('screen-select');
    }
  </script>
</body>
</html>
